import{p as r,a as u,w as z}from"./chunk-EPOLDU6W-CP3WDhNt.js";function M({cameraEnabled:e,isPlaying:n,isReading:t,isLoading:i,tangibleInstance:s,onCameraToggle:o,onPlayStop:a,onRead:l}){return r.jsxs("header",{className:"header",role:"banner",children:[r.jsx("div",{className:"logo-container",children:r.jsx("img",{src:"https://armbennett.github.io/tangible-11ty/assets/img/tibbl-logo.png",alt:"Application logo",className:"logo"})}),r.jsxs("nav",{className:"header-buttons",role:"navigation","aria-label":"Main navigation",children:[r.jsxs("button",{className:"header-button",onClick:o,"aria-label":e?"Disable camera":"Enable camera","aria-pressed":e,disabled:i||!s,children:[r.jsx("i",{className:"fa-solid fa-camera fa-2xl","aria-hidden":"true"}),r.jsx("span",{children:"Camera"})]}),r.jsxs("button",{className:"header-button",onClick:a,"aria-label":n?"Stop code execution":"Play and execute code","aria-pressed":n,disabled:i||!s,children:[r.jsx("i",{className:`fa-solid ${n?"fa-stop":"fa-play"} fa-2xl`,"aria-hidden":"true"}),r.jsx("span",{children:n?"Stop":"Play"})]}),r.jsxs("button",{className:"header-button",onClick:l,"aria-label":t?"Stop reading code":"Read out code text","aria-pressed":t,disabled:i||!s,children:[r.jsx("i",{className:"fa-brands fa-readme fa-2xl","aria-hidden":"true"}),r.jsx("span",{children:t?"Stop":"Read"})]})]})]})}function H({cameraEnabled:e}){return r.jsxs(r.Fragment,{children:[e&&r.jsx("section",{className:"camera-section",role:"region","aria-label":"Camera view",children:r.jsx("div",{className:"video-container",children:r.jsx("canvas",{id:"video-canvas",width:"640",height:"480","aria-label":"Code tile detection overlay"})})}),!e&&r.jsx("canvas",{id:"video-canvas",width:"640",height:"480",style:{display:"none"}})]})}function T({threadNumber:e,value:n,onChange:t,soundSets:i}){const s=`thread${e}`,o=`Thread ${e}`;return r.jsxs("div",{className:"dropdown-group",children:[r.jsx("label",{htmlFor:s,className:"dropdown-label",children:o}),r.jsx("select",{id:s,className:"dropdown",value:n,onChange:a=>t(a.target.value),"aria-label":`Select ${o} sound options`,children:i.map(a=>r.jsx("option",{value:a.value,children:a.label},a.value))})]})}function F({cameraEnabled:e,codeText:n,textareaRef:t,soundSets:i,soundSetOptions:s,onCodeTextChange:o,onSoundSetChange:a}){return r.jsxs("section",{className:`output-section ${e?"camera-active":""}`,role:"region","aria-label":"Code output and thread selection",children:[r.jsx("div",{className:"textbox-container",children:r.jsx("textarea",{ref:t,value:n,onChange:l=>o(l.target.value),className:"output-textbox",placeholder:`Thread 1
Loop 4 times
Play 5
End loop
Play 7

Thread 2
Delay 4
Loop 3 times
Play 8
End loop`,"aria-label":"Code output text area"})}),r.jsxs("div",{className:"dropdown-container",children:[r.jsx(T,{threadNumber:1,value:i[0],onChange:l=>a(0,l),soundSets:s}),r.jsx(T,{threadNumber:2,value:i[1],onChange:l=>a(1,l),soundSets:s}),r.jsx(T,{threadNumber:3,value:i[2],onChange:l=>a(2,l),soundSets:s})]})]})}function V(e){u.useEffect(()=>{if(!e)return;let n;const t=()=>{const o=document.getElementById("video-canvas-video"),a=document.getElementById("video-canvas"),l=document.querySelector(".video-container");if(o&&a&&l){l.contains(o)||l.insertBefore(o,l.firstChild),o.style.display="block",l.contains(a)||l.appendChild(a),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.pointerEvents="none",a.style.zIndex="10",a.style.display="block";const c=()=>{a.width=640,a.height=480},d=()=>{c()};o.addEventListener("loadedmetadata",d),o.addEventListener("playing",d),c(),n=()=>{o.removeEventListener("loadedmetadata",d),o.removeEventListener("playing",d)}}},i=setInterval(()=>{document.getElementById("video-canvas-video")&&(t(),clearInterval(i))},100),s=setTimeout(()=>clearInterval(i),5e3);return()=>{clearInterval(i),clearTimeout(s),n&&n()}},[e])}function U(e,n,t){u.useEffect(()=>{if(!e)return;const i=setInterval(()=>{n&&!e.synthesis.speaking&&t(!1)},100);return()=>clearInterval(i)},[e,n,t])}async function D(e,n){const i=await(await fetch(`${e}/assets/js/howler.js`)).text(),s=document.createElement("script");s.textContent=i,document.head.appendChild(s);const a=await(await fetch(`${e}/assets/js/topcodes.js`)).text(),l=document.createElement("script");l.textContent=a,document.head.appendChild(l);let y=(await(await fetch(`${e}/assets/js/tangible.js`)).text()).replace("export default class Tangible","window.Tangible = class Tangible");y=y.replace(/setupTangible\(\) \{[\s\S]*?setVideoFrameCallback\("video-canvas", function \(jsonString\) \{[\s\S]*?\}, this\);[\s\S]*?\}/,`setupTangible() {
        this.setVideoCanvasHeight('video-canvas');
        let tangible = this;
        
        TopCodes.setVideoFrameCallback("video-canvas", function (jsonString) {
            
            var canvas = document.querySelector("#video-canvas");
            if (!canvas) {
                console.error("Canvas not found in callback!");
                return;
            }
            var ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error("Could not get context in callback!");
                return;
            }
            
            var json = JSON.parse(jsonString);
            var topcodes = json.topcodes;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = "rgba(255, 0, 0, 0.3)";
            ctx.lineWidth = 10;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
            for (let i = 0; i < topcodes.length; i++) {
                ctx.beginPath();
                ctx.arc(topcodes[i].x - (topcodes[i].radius/2), topcodes[i].y, topcodes[i].radius, 0, Math.PI * 2, true);
                ctx.fill();
                ctx.font = "26px Arial";
                ctx.fillStyle = "rgba(255, 0, 0, 0.8)";
                ctx.fillText(topcodes[i].code, topcodes[i].x - topcodes[i].radius, topcodes[i].y);
                ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
            }
            tangible.currentCodes = topcodes;
            tangible.once = true;
        }, this);
    }`);const S=document.createElement("script");if(S.textContent=y,document.head.appendChild(S),await new Promise(h=>setTimeout(h,200)),window.Tangible){const h=new window.Tangible;return h.setupTangible(),setTimeout(()=>{const w=document.getElementById("video-canvas");if(w){const C=w.getContext("2d");C?(C.fillStyle="rgba(0, 0, 255, 0.5)",C.fillRect(200,200,100,100)):console.error("Manual test: Could not get canvas context")}else console.error("Manual test: Canvas not found")},1e3),n(h,"Numbers",0),n(h,"Notifications",1),n(h,"Notifications",2),h}else return console.error("window.Tangible not available"),null}function O(e,n,t,i){u.useEffect(()=>{(async()=>{try{const o=await D(e,i);n(o),t(!1)}catch(o){console.error("Error loading scripts:",o),t(!1)}})()},[e,n,t,i])}let m=!1,x=[];function B(e,n,t,i){u.useEffect(()=>{const s=o=>{o.touches.length===3&&(o.preventDefault(),m&&(x.forEach(a=>clearTimeout(a)),x=[],t&&t.synthesis.cancel(),m=!1),n&&t?(m=!0,(async()=>{t.readCode("3");const l=setTimeout(async()=>{if(!m)return;t.readCode("2");const c=setTimeout(async()=>{if(!m)return;t.readCode("1");const d=setTimeout(()=>{m&&(m=!1,x=[],e())},1e3);x.push(d)},1e3);x.push(c)},1e3);x.push(l)})()):e())};return document.addEventListener("touchstart",s,{passive:!1}),()=>{document.removeEventListener("touchstart",s),x.forEach(o=>clearTimeout(o)),x=[],m=!1}},i)}function k(e){return e.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"").toLowerCase().replace(/(^|\n)([a-z])/g,(n,t,i)=>t+i.toUpperCase()).replace(/x/g,"X")}function R(e){const n=e.split(`
`).map(s=>s.trim().toLowerCase()),t=[];let i=!1;for(let s=0;s<n.length;s++){const o=n[s];if(o.startsWith("loop"))t.push({type:"loop",index:s+1});else if(o.startsWith("end loop")||o.startsWith("endloop")){if(t.length===0||t[t.length-1].type!=="loop")return{valid:!1,error:`Unexpected end loop at position ${s+1}`};t.pop()}else if(o.startsWith("if"))t.push({type:"if",index:s+1});else if(o.startsWith("end if")||o.startsWith("endif")){if(t.length===0||t[t.length-1].type!=="if")return{valid:!1,error:`Unexpected end if at position ${s+1}`};t.pop()}else if(o.startsWith("function"))t.push({type:"function",index:s+1});else if(o.startsWith("end function")||o.startsWith("endfunction")){if(t.length===0||t[t.length-1].type!=="function")return{valid:!1,error:`Unexpected end function at position ${s+1}`};t.pop()}else if(o.startsWith("x =")||o.startsWith("x="))i=!0;else if((o.startsWith("play x")||o.startsWith("if x"))&&!i)return{valid:!1,error:`Variable used at ${s+1} without being set.`}}if(t.length>0){const s=t[t.length-1];return{valid:!1,error:`Missing end tile for ${s.type} in position ${s.index}.`}}return{valid:!0}}let p=!1,f=null;function _(e,n,t,i,s,o){return()=>{if(!e){console.error("Tangible instance not initialized");return}if(f&&(clearInterval(f),f=null),e.isAudioPlaying()||p){e.stopAllSounds(),o(!1),p=!1;return}if(p=!0,n){const l=e.scanCode();if(l){const c=k(l);s(c);const d=R(c);if(!d.valid&&d.error){e.readCode(d.error),p=!1;return}c&&c.trim()?(e.codeThreads=[[],[],[]],e.runTextCode(c),o(!0),f=setInterval(()=>{e.isAudioPlaying()||(o(!1),p=!1,f&&(clearInterval(f),f=null))},100)):p=!1;return}p=!1}const a=i.current?.value||t;if(a&&a.trim()){const l=R(a);if(!l.valid&&l.error){e.readCode(l.error),p=!1;return}}a&&a.trim()?(e.codeThreads=[[],[],[]],e.runTextCode(a),o(!0),f=setInterval(()=>{e.isAudioPlaying()||(o(!1),p=!1,f&&(clearInterval(f),f=null))},100)):(e.readCode("No code to run."),p=!1)}}let g=!1;function J(e,n,t,i,s,o){return()=>{if(!e){console.error("Tangible instance not initialized");return}if(e.synthesis.speaking||g){e.synthesis.cancel(),o(!1),g=!1;return}if(e.isAudioPlaying()){e.stopAllSounds();return}if(g=!0,n){const l=e.scanCode();if(l){const c=k(l);s(c),c&&c.trim()?(e.readCode(c),o(!0)):g=!1;return}g=!1}const a=i.current?.value||t;a&&a.trim()?(e.readCode(a),o(!0)):(e.readCode("No code to read."),g=!1)}}function $(e,n,t,i){const s=new window.Howl({src:[`${i}/assets/sound/${n}.mp3`],volume:.2,sprite:e.soundSets[n]});e.threads[t]=s}const N="https://raw.githubusercontent.com/armbennett/tangible-11ty/main",q=[{value:"Numbers",label:"Numbers"},{value:"MusicLoops1",label:"Music Loops 1"},{value:"Mystery",label:"Mystery"},{value:"Notifications",label:"Notifications"},{value:"OdeToJoy",label:"Ode to Joy"},{value:"FurElise",label:"Fur Elise"}];function G(){const[e,n]=u.useState(!1),[t,i]=u.useState(""),[s,o]=u.useState(!0),[a,l]=u.useState(["Numbers","Notifications","Notifications"]),[c,d]=u.useState(null),[y,S]=u.useState(!1),[h,w]=u.useState(!1),C=u.useRef(null),W=u.useCallback((v,b,j)=>{$(v,b,j,N)},[]);V(e),U(c,y,S),O(N,d,o,W);const E=_(c,e,t,C,i,w),L=J(c,e,t,C,i,S);B(E,e,c,[c,e,t]);const P=()=>{if(!c){console.error("Tangible instance not initialized");return}const v=!e;c.cameraStatus=v,window.TopCodes&&(window.TopCodes.startStopVideoScan("video-canvas",c.mode),v||setTimeout(()=>{delete window.TopCodes._mediaStreams["video-canvas"]},100)),n(v)},A=(v,b)=>{const j=[...a];j[v]=b,l(j),c&&$(c,b,v,N)};return r.jsxs("div",{className:"app-container",children:[r.jsx(M,{cameraEnabled:e,isPlaying:h,isReading:y,isLoading:s,tangibleInstance:c,onCameraToggle:P,onPlayStop:E,onRead:L}),r.jsx(H,{cameraEnabled:e}),r.jsx(F,{cameraEnabled:e,codeText:t,textareaRef:C,soundSets:a,soundSetOptions:q,onCodeTextChange:i,onSoundSetChange:A})]})}function K({}){return[{title:"New React Router App"},{name:"description",content:"Welcome to React Router!"}]}const Q=z(function(){return r.jsx(G,{})});export{Q as default,K as meta};
