import{a as i,p as o,w as k}from"./chunk-EPOLDU6W-CP3WDhNt.js";const v="https://raw.githubusercontent.com/armbennett/tangible-11ty/main",j=[{value:"Numbers",label:"Numbers"},{value:"MusicLoops1",label:"Music Loops 1"},{value:"Mystery",label:"Mystery"},{value:"Notifications",label:"Notifications"},{value:"OdeToJoy",label:"Ode to Joy"},{value:"FurElise",label:"Fur Elise"}];function $(){const[l,E]=i.useState(!1),[p,f]=i.useState(""),[x,S]=i.useState(!0),[g,R]=i.useState(["Numbers","Notifications","Notifications"]),[a,I]=i.useState(null),[d,h]=i.useState(!1),[m,u]=i.useState(!1),w=i.useRef(null),b=(e,n,t)=>{console.log(`Preloading sound set: ${n} for thread ${t}`);const s=new window.Howl({src:[`${v}/assets/sound/${n}.mp3`],volume:.2,sprite:e.soundSets[n]});e.threads[t]=s};i.useEffect(()=>{if(!l)return;const e=()=>{const t=document.getElementById("video-canvas-video"),s=document.getElementById("video-canvas"),c=document.querySelector(".video-container");t&&s&&c&&(console.log("Moving video to container and positioning canvas"),c.contains(t)||c.insertBefore(t,c.firstChild),t.style.display="block",c.contains(s)||c.appendChild(s),s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none",s.style.zIndex="10",s.style.display="block",console.log("Video and canvas configured"))},n=setInterval(()=>{document.getElementById("video-canvas-video")&&(e(),clearInterval(n))},100);return setTimeout(()=>clearInterval(n),5e3),()=>clearInterval(n)},[l]),i.useEffect(()=>{(async()=>{try{console.log("Loading Howler.js");const t=await(await fetch(`${v}/assets/js/howler.js`)).text(),s=document.createElement("script");s.textContent=t,document.head.appendChild(s),console.log("Howler.js loaded"),console.log("Loading TopCodes.js");const L=await(await fetch(`${v}/assets/js/topcodes.js`)).text(),y=document.createElement("script");y.textContent=L,document.head.appendChild(y),console.log("TopCodes.js loaded"),console.log("Loading Tangible.js");const O=(await(await fetch(`${v}/assets/js/tangible.js`)).text()).replace("export default class Tangible","window.Tangible = class Tangible"),N=document.createElement("script");if(N.textContent=O,document.head.appendChild(N),console.log("Tangible.js loaded"),await new Promise(r=>setTimeout(r,200)),window.Tangible){console.log("Creating Tangible instance");const r=new window.Tangible;r.setupTangible(),console.log("setupTangible called"),b(r,"Numbers",0),b(r,"Notifications",1),b(r,"Notifications",2),I(r)}else console.error("window.Tangible not available");S(!1)}catch(n){console.error("Error loading scripts:",n),S(!1)}})()},[]);const P=()=>{if(!a){console.error("Tangible instance not initialized");return}const e=!l;console.log("Toggling camera to:",e),a.cameraStatus=e,window.TopCodes&&(window.TopCodes.startStopVideoScan("video-canvas",a.mode),e||setTimeout(()=>{delete window.TopCodes._mediaStreams["video-canvas"],console.log("Deleted mediaStream reference to allow reinitialization")},100)),E(e)},C=(e,n)=>{console.log(`Changing thread ${e} to sound set: ${n}`);const t=[...g];t[e]=n,R(t),a&&b(a,n,e)},T=()=>{if(!a){console.error("Tangible instance not initialized");return}if(a.isAudioPlaying()){console.log("Stopping audio"),a.stopAllSounds(),u(!1);return}if(l){console.log("Camera enabled, scanning code");const n=a.scanCode();if(console.log("Scanned code:",n),n){const t=n.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"");if(f(t),console.log("Running scanned code:",t),t&&t.trim()){a.codeThreads=[[],[],[]],a.runTextCode(t),u(!0);const s=setInterval(()=>{a.isAudioPlaying()||(u(!1),clearInterval(s))},100)}return}}const e=w.current?.value||p;if(console.log("Running code:",e),e&&e.trim()){a.codeThreads=[[],[],[]],a.runTextCode(e),u(!0);const n=setInterval(()=>{a.isAudioPlaying()||(u(!1),clearInterval(n))},100)}else console.log("No code to run")},A=()=>{if(!a){console.error("Tangible instance not initialized");return}if(a.synthesis.speaking){console.log("Stopping speech synthesis"),a.synthesis.cancel(),h(!1);return}if(a.isAudioPlaying()){console.log("Stopping audio"),a.stopAllSounds();return}if(l){console.log("Camera enabled, scanning code for reading");const n=a.scanCode();if(console.log("Scanned code:",n),n){const t=n.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"");f(t),console.log("Reading scanned code:",t),t&&t.trim()&&(a.readCode(t),h(!0));return}}const e=w.current?.value||p;console.log("Reading code:",e),e&&e.trim()?(a.readCode(e),h(!0)):console.log("No code to read")};return i.useEffect(()=>{if(!a)return;const e=setInterval(()=>{d&&!a.synthesis.speaking&&h(!1)},100);return()=>clearInterval(e)},[a,d]),i.useEffect(()=>{const e=n=>{n.touches.length===3&&(n.preventDefault(),T())};return document.addEventListener("touchstart",e,{passive:!1}),()=>{document.removeEventListener("touchstart",e)}},[a,l,p]),o.jsxs("div",{className:"app-container",children:[o.jsxs("header",{className:"header",role:"banner",children:[o.jsx("div",{className:"logo-container",children:o.jsx("img",{src:"https://armbennett.github.io/tangible-11ty/assets/img/tibbl-logo.png",alt:"Application logo",className:"logo"})}),o.jsxs("nav",{className:"header-buttons",role:"navigation","aria-label":"Main navigation",children:[o.jsxs("button",{className:"header-button",onClick:P,"aria-label":l?"Disable camera":"Enable camera","aria-pressed":l,disabled:x||!a,children:[o.jsx("i",{className:"fa-solid fa-camera fa-2xl","aria-hidden":"true"}),o.jsx("span",{children:"Camera"})]}),o.jsxs("button",{className:"header-button",onClick:T,"aria-label":m?"Stop code execution":"Play and execute code","aria-pressed":m,disabled:x||!a,children:[o.jsx("i",{className:`fa-solid ${m?"fa-stop":"fa-play"} fa-2xl`,"aria-hidden":"true"}),o.jsx("span",{children:m?"Stop":"Play"})]}),o.jsxs("button",{className:"header-button",onClick:A,"aria-label":d?"Stop reading code":"Read out code text","aria-pressed":d,disabled:x||!a,children:[o.jsx("i",{className:"fa-brands fa-readme fa-2xl","aria-hidden":"true"}),o.jsx("span",{children:d?"Stop":"Read"})]})]})]}),l&&o.jsx("section",{className:"camera-section",role:"region","aria-label":"Camera view",children:o.jsx("div",{className:"video-container",children:o.jsx("canvas",{id:"video-canvas",width:"640",height:"480","aria-label":"Code tile detection overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:10}})})}),!l&&o.jsx("canvas",{id:"video-canvas",width:"640",height:"480",style:{display:"none"}}),o.jsxs("section",{className:`output-section ${l?"camera-active":""}`,role:"region","aria-label":"Code output and thread selection",children:[o.jsx("div",{className:"textbox-container",children:o.jsx("textarea",{ref:w,value:p,onChange:e=>f(e.target.value),className:"output-textbox",placeholder:"THREAD 1\\nLOOP 4 TIMES\\nPLAY 5\\nEND LOOP\\nPLAY 7\\n\\nTHREAD 2\\nDELAY 4\\nLOOP 3 TIMES\\nPLAY 8\\nEND LOOP","aria-label":"Code output text area"})}),o.jsxs("div",{className:"dropdown-container",children:[o.jsxs("div",{className:"dropdown-group",children:[o.jsx("label",{htmlFor:"thread1",className:"dropdown-label",children:"Thread 1"}),o.jsx("select",{id:"thread1",className:"dropdown",value:g[0],onChange:e=>C(0,e.target.value),"aria-label":"Select Thread 1 sound options",children:j.map(e=>o.jsx("option",{value:e.value,children:e.label},e.value))})]}),o.jsxs("div",{className:"dropdown-group",children:[o.jsx("label",{htmlFor:"thread2",className:"dropdown-label",children:"Thread 2"}),o.jsx("select",{id:"thread2",className:"dropdown",value:g[1],onChange:e=>C(1,e.target.value),"aria-label":"Select Thread 2 sound options",children:j.map(e=>o.jsx("option",{value:e.value,children:e.label},e.value))})]}),o.jsxs("div",{className:"dropdown-group",children:[o.jsx("label",{htmlFor:"thread3",className:"dropdown-label",children:"Thread 3"}),o.jsx("select",{id:"thread3",className:"dropdown",value:g[2],onChange:e=>C(2,e.target.value),"aria-label":"Select Thread 3 sound options",children:j.map(e=>o.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]})]})}function z({}){return[{title:"New React Router App"},{name:"description",content:"Welcome to React Router!"}]}const B=k(function(){return o.jsx($,{})});export{B as default,z as meta};
