import{p as r,a as w,w as V}from"./chunk-EPOLDU6W-CP3WDhNt.js";function G({cameraEnabled:e,isPlaying:o,isReading:t,isLoading:a,tangibleInstance:n,onCameraToggle:s,onPlayStop:c,onRead:d}){return r.jsxs("header",{className:"header",role:"banner",children:[r.jsx("div",{className:"logo-container","aria-hidden":"true",children:r.jsx("img",{src:"https://armbennett.github.io/tangible-11ty/assets/img/tibbl-logo.png",alt:"Application logo",className:"logo"})}),r.jsxs("nav",{className:"header-buttons",role:"navigation","aria-label":"Main navigation",children:[r.jsxs("button",{className:"header-button",onClick:s,"aria-label":e?"Disable camera":"Enable camera","aria-pressed":e,disabled:a||!n,children:[r.jsx("i",{className:"fa-solid fa-camera fa-2xl","aria-hidden":"true"}),r.jsx("span",{children:"Camera"})]}),r.jsxs("button",{className:"header-button",onClick:c,"aria-label":o?"Stop code execution":"Play and execute code","aria-pressed":o,disabled:a||!n,children:[r.jsx("i",{className:`fa-solid ${o?"fa-stop":"fa-play"} fa-2xl`,"aria-hidden":"true"}),r.jsx("span",{children:o?"Stop":"Play"})]}),r.jsxs("button",{className:"header-button",onClick:d,"aria-label":t?"Stop reading code":"Read out code text","aria-pressed":t,disabled:a||!n,children:[r.jsx("i",{className:"fa-brands fa-readme fa-2xl","aria-hidden":"true"}),r.jsx("span",{children:t?"Stop":"Read"})]})]})]})}function X({cameraEnabled:e,rotation:o,onRotate:t}){const a=o===90||o===270;return r.jsxs(r.Fragment,{children:[e&&r.jsx("section",{className:"camera-section",role:"region","aria-label":"Camera view",children:r.jsxs("div",{className:"video-container",children:[r.jsx("canvas",{id:"video-canvas",width:"640",height:"480","aria-label":"Camera view and code tile detection overlay",className:a?"rotated-sideways":"",style:{transform:`rotate(${o}deg)`}}),r.jsx("button",{className:"rotate-button",onClick:t,"aria-label":`Rotate camera view 90 degrees clockwise (currently ${o} degrees)`,type:"button",children:r.jsx("i",{className:"fa-solid fa-camera-rotate","aria-hidden":"true"})})]})}),!e&&r.jsx("canvas",{id:"video-canvas",width:"640",height:"480",style:{display:"none"}})]})}function z({threadNumber:e,value:o,onChange:t,soundSets:a}){const n=`thread${e}`,s=`Thread ${e}`;return r.jsxs("div",{className:"dropdown-group",children:[r.jsx("label",{htmlFor:n,className:"dropdown-label",children:s}),r.jsx("select",{id:n,className:"dropdown",value:o,onChange:c=>t(c.target.value),"aria-label":`Select ${s} sound options`,children:a.map(c=>r.jsx("option",{value:c.value,children:c.label},c.value))})]})}function Y({cameraEnabled:e,codeText:o,textareaRef:t,soundSets:a,soundSetOptions:n,onCodeTextChange:s,onSoundSetChange:c,placeholder:d}){return r.jsxs("section",{className:`output-section ${e?"camera-active":""}`,role:"region","aria-label":"Code output and thread selection",children:[r.jsx("div",{className:"textbox-container",children:r.jsx("textarea",{ref:t,value:o,onChange:i=>s(i.target.value),className:"output-textbox",placeholder:d,"aria-label":"Code output text area"})}),r.jsxs("div",{className:"dropdown-container",children:[r.jsx(z,{threadNumber:1,value:a[0],onChange:i=>c(0,i),soundSets:n}),r.jsx(z,{threadNumber:2,value:a[1],onChange:i=>c(1,i),soundSets:n}),r.jsx(z,{threadNumber:3,value:a[2],onChange:i=>c(2,i),soundSets:n})]})]})}function _(e,o){return Math.abs(e.y-o.y)<=40?e.x==o.x?0:e.x<o.x?1:-1:e.y<o.y?-1:1}function J(e){e.sort(_);let o=[],t=Array(),a=-1;for(let n=0;n<e.length;n++)a>=0&&e[n].y-a>=40?(o.push(t),t=Array(),a=e[n].y):a<0&&(a=e[n].y),t.push(e[n]);return o.push(t),o}function Q(e){w.useEffect(()=>{if(!e)return;const o=v=>{const j=J(v.detail.topcodes),S=document.getElementById("video-canvas-video"),h=document.getElementById("video-canvas");if(!S||!h||S.readyState<2)return;const u=h.getContext("2d");if(!u)return;const b=S.videoWidth,y=S.videoHeight,H=y>b;let A,L;H?(A=b,L=y):(A=640,L=480),(h.width!==A||h.height!==L)&&(h.width=A,h.height=L),u.clearRect(0,0,h.width,h.height),u.drawImage(S,0,0,h.width,h.height),u.fillStyle="$00640080",u.strokeStyle="#006400",u.lineWidth=5;let k=1;for(let W=0;W<j.length;W++)for(let R=0;R<j[W].length;R++){const x=j[W][R],N=h.width-x.x,P=x.y;u.beginPath(),u.arc(N,P,x.radius,0,Math.PI*2),u.fill(),u.stroke(),u.fillStyle="rgba(255, 255, 255, 1)",u.font="900 28px monospace",u.textAlign="center",u.textBaseline="middle",u.fillText(`${k}`,N,P),u.fillStyle="#00640080",k++}},t=()=>{const v=document.getElementById("video-canvas-video"),l=document.getElementById("video-canvas"),j=document.querySelector(".video-container");if(v&&l&&j){v.style.display="none";const S=v.videoWidth||640,h=v.videoHeight||480,u=h>S;let b,y;u?(b=S,y=h):(b=640,y=480),(l.width!==b||l.height!==y)&&(l.width=b,l.height=y),j.contains(l)||j.appendChild(l);const H=l.classList.contains("rotated-sideways");l.style.display="block",l.style.position="relative",l.style.objectFit="contain",H?(l.style.width="auto",l.style.height="auto",l.style.maxWidth="50vh",l.style.maxHeight="none"):(l.style.width="100%",l.style.height="auto",l.style.maxHeight="50vh",l.style.maxWidth="")}},a=document.getElementById("video-canvas-video"),n=()=>{a&&t()},s=()=>{t()};a&&(a.readyState>=1&&t(),a.addEventListener("loadedmetadata",n),a.addEventListener("resize",s));const c=()=>{setTimeout(()=>{t()},100)};window.addEventListener("orientationchange",c),window.addEventListener("resize",c);const d=setInterval(()=>{const v=document.getElementById("video-canvas-video");v&&v.readyState>=1&&(t(),clearInterval(d))},100),i=setTimeout(()=>clearInterval(d),5e3);window.addEventListener("topcodes-detected",o);const f=document.getElementById("video-canvas");let p=null;return f&&(p=new MutationObserver(()=>{t()}),p.observe(f,{attributes:!0,attributeFilter:["class"]})),()=>{clearInterval(d),clearTimeout(i),window.removeEventListener("topcodes-detected",o),window.removeEventListener("orientationchange",c),window.removeEventListener("resize",c),a&&(a.removeEventListener("loadedmetadata",n),a.removeEventListener("resize",s)),p&&p.disconnect()}},[e])}function Z(e,o,t){w.useEffect(()=>{if(!e)return;const a=setInterval(()=>{o&&!e.synthesis.speaking&&t(!1)},100);return()=>clearInterval(a)},[e,o,t])}async function q(e,o){const a=await(await fetch(`${e}/assets/js/howler.js`)).text(),n=document.createElement("script");n.textContent=a,document.head.appendChild(n);const c=await(await fetch(`${e}/assets/js/topcodes.js`)).text(),d=document.createElement("script");d.textContent=c,document.head.appendChild(d);let p=(await(await fetch(`${e}/assets/js/tangible.js`)).text()).replace("export default class Tangible","window.Tangible = class Tangible");p=p.replace(/setupTangible\(\) \{[\s\S]*?setVideoFrameCallback\("video-canvas", function \(jsonString\) \{[\s\S]*?\}, this\);[\s\S]*?\}/,`setupTangible() {
        this.setVideoCanvasHeight('video-canvas');
        let tangible = this;
        
        TopCodes.setVideoFrameCallback("video-canvas", function (jsonString) {
            var json = JSON.parse(jsonString);
            var topcodes = json.topcodes;
            tangible.currentCodes = topcodes;
            tangible.once = true;
            
            const event = new CustomEvent('topcodes-detected', { 
                detail: { topcodes: topcodes } 
            });
            window.dispatchEvent(event);
        }, this);
    }`);const v=document.createElement("script");if(v.textContent=p,document.head.appendChild(v),await new Promise(l=>setTimeout(l,200)),window.Tangible){const l=new window.Tangible;return l.setupTangible(),o(l,"Numbers",0),o(l,"Notifications",1),o(l,"Notifications",2),l}else return console.error("window.Tangible not available"),null}function K(e,o,t,a){w.useEffect(()=>{(async()=>{try{const s=await q(e,a);o(s),t(!1)}catch(s){console.error("Error loading scripts:",s),t(!1)}})()},[e,o,t,a])}let E=!1,T=[];function D(e){E&&(T.forEach(o=>clearTimeout(o)),T=[],e&&e.synthesis.cancel(),E=!1)}function I(e,o,t,a){w.useEffect(()=>{const n=s=>{s.touches.length===3&&(s.preventDefault(),D(t),o&&t?(E=!0,(async()=>{t.readCode("3");const d=setTimeout(async()=>{if(!E)return;t.readCode("2");const i=setTimeout(async()=>{if(!E)return;t.readCode("1");const f=setTimeout(()=>{E&&(E=!1,T=[],e())},1e3);T.push(f)},1e3);T.push(i)},1e3);T.push(d)})()):e())};return document.addEventListener("touchstart",n,{passive:!1}),()=>{document.removeEventListener("touchstart",n),T.forEach(s=>clearTimeout(s)),T=[],E=!1}},a)}function U(e){return e.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"").toLowerCase().replace(/(^|\n)([a-z])/g,(o,t,a)=>t+a.toUpperCase()).replace(/x/g,"X")}function F(e){const o=e.split(`
`).map(n=>n.trim().toLowerCase()),t=[];let a=!1;for(let n=0;n<o.length;n++){const s=o[n];if(s.startsWith("loop"))t.push({type:"loop",index:n+1});else if(s.startsWith("end loop")||s.startsWith("endloop")){if(t.length===0||t[t.length-1].type!=="loop")return{valid:!1,error:`Unexpected end loop at position ${n+1}`};t.pop()}else if(s.startsWith("if"))t.push({type:"if",index:n+1});else if(s.startsWith("end if")||s.startsWith("endif")){if(t.length===0||t[t.length-1].type!=="if")return{valid:!1,error:`Unexpected end if at position ${n+1}`};t.pop()}else if(s.startsWith("function"))t.push({type:"function",index:n+1});else if(s.startsWith("end function")||s.startsWith("endfunction")){if(t.length===0||t[t.length-1].type!=="function")return{valid:!1,error:`Unexpected end function at position ${n+1}`};t.pop()}else if(s.startsWith("x =")||s.startsWith("x="))a=!0;else if((s.startsWith("play x")||s.startsWith("if x"))&&!a)return{valid:!1,error:`Variable used at ${n+1} without being set.`}}if(t.length>0){const n=t[t.length-1];return{valid:!1,error:`Missing end tile for ${n.type} in position ${n.index}.`}}return{valid:!0}}let g=!1,m=null;function ee(e,o,t,a,n,s,c){return()=>{if(!e){console.error("Tangible instance not initialized");return}if(m&&(clearInterval(m),m=null),e.isAudioPlaying()||g){e.stopAllSounds(),D(e),s(!1),g=!1;return}if(g=!0,o){const i=e.scanCode();if(i){const f=U(i);n(f);const p=F(f);if(!p.valid&&p.error){e.readCode(p.error),g=!1;return}f&&f.trim()?(e.codeThreads=[[],[],[]],e.runTextCode(f),s(!0),m=setInterval(()=>{e.isAudioPlaying()||(s(!1),g=!1,m&&(clearInterval(m),m=null))},100)):g=!1;return}g=!1}const d=a.current?.value||t;if(d&&d.trim()){const i=F(d);if(!i.valid&&i.error){e.readCode(i.error),g=!1;return}}d&&d.trim()?(e.codeThreads=[[],[],[]],e.runTextCode(d),s(!0),m=setInterval(()=>{e.isAudioPlaying()||(s(!1),g=!1,m&&(clearInterval(m),m=null))},100)):!d&&!o?(n(c),e.runTextCode(c),s(!0),m=setInterval(()=>{e.isAudioPlaying()||(s(!1),g=!1,m&&(clearInterval(m),m=null))},100)):(e.readCode("No code to run."),g=!1)}}let $=!1;function te(e,o,t,a,n,s,c){return()=>{if(!e){console.error("Tangible instance not initialized");return}if(e.synthesis.speaking||$){e.synthesis.cancel(),s(!1),$=!1;return}if(e.isAudioPlaying()){e.stopAllSounds();return}if($=!0,o){const i=e.scanCode();if(i){const f=U(i);n(f),f&&f.trim()?(e.readCode(f),s(!0)):$=!1;return}$=!1}const d=a.current?.value||t;if(d&&d.trim())e.readCode(d),s(!0);else if(!d&&!o){const i=`Thread 1
Loop 4 times
Play 5
End loop
Play 7

Thread 2
Delay 4
Loop 3 times
Play 8
End loop`;n(i),e.readCode(i),s(!0)}else e.readCode("No code to read."),$=!1}}function M(e,o,t,a){const n=new window.Howl({src:[`${a}/assets/sound/${o}.mp3`],volume:.2,sprite:e.soundSets[o]});e.threads[t]=n}const oe=()=>{if(typeof window<"u"&&window.Howler)try{const e=new window.Howl({src:["data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQAAAAA="],volume:0,onload:()=>{e.play(),e.unload()}})}catch(e){console.error("Failed to initialize audio context:",e)}if(typeof window<"u"&&window.speechSynthesis)try{const e=new SpeechSynthesisUtterance("");e.volume=0,window.speechSynthesis.speak(e),window.speechSynthesis.cancel()}catch(e){console.error("Failed to initialize speech synthesis:",e)}},B="https://raw.githubusercontent.com/armbennett/tangible-11ty/main",ne=[{value:"Numbers",label:"Numbers"},{value:"MusicLoops1",label:"Music Loops 1"},{value:"Mystery",label:"Mystery"},{value:"Notifications",label:"Notifications"},{value:"OdeToJoy",label:"Ode to Joy"},{value:"FurElise",label:"Fur Elise"}],O=`Thread 1
Loop 4 times
Play 5
End loop
Play 7

Thread 2
Delay 4
Loop 3 times
Play 8
End loop`;function ae(){const[e,o]=w.useState(!1),[t,a]=w.useState(""),[n,s]=w.useState(!0),[c,d]=w.useState(["Numbers","Notifications","Notifications"]),[i,f]=w.useState(null),[p,v]=w.useState(!1),[l,j]=w.useState(!1),[S,h]=w.useState(0),[u,b]=w.useState(!1),y=w.useRef(null),H=w.useCallback((C,x,N)=>{M(C,x,N,B)},[]);Q(e),Z(i,p,v),K(B,f,s,H);const A=ee(i,e,t,y,a,j,O),L=te(i,e,t,y,a,v);I(A,e,i,[i,e,t]);const k=()=>{if(!i){console.error("Tangible instance not initialized");return}u||(oe(),b(!0));const C=!e;i.cameraStatus=C,window.TopCodes&&(window.TopCodes.startStopVideoScan("video-canvas",i.mode),C||setTimeout(()=>{const x=document.getElementById("video-canvas-video");x&&(x.srcObject=null,x.remove()),delete window.TopCodes._mediaStreams["video-canvas"]},100)),o(C)},W=()=>{h(C=>(C+90)%360)},R=(C,x)=>{const N=[...c];N[C]=x,d(N),i&&M(i,x,C,B)};return r.jsxs("div",{className:"app-container",children:[r.jsx(G,{cameraEnabled:e,isPlaying:l,isReading:p,isLoading:n,tangibleInstance:i,onCameraToggle:k,onPlayStop:A,onRead:L}),r.jsx(X,{cameraEnabled:e,rotation:S,onRotate:W}),r.jsx(Y,{cameraEnabled:e,codeText:t,textareaRef:y,soundSets:c,soundSetOptions:ne,onCodeTextChange:a,onSoundSetChange:R,placeholder:O})]})}function ie({}){return[{title:"TIBBL"},{name:"description",content:"TIBBL web application"}]}const re=V(function(){return r.jsx(ae,{})});export{re as default,ie as meta};
