import{a as c,p as a,w as B}from"./chunk-EPOLDU6W-CP3WDhNt.js";const C="https://raw.githubusercontent.com/armbennett/tangible-11ty/main",I=[{value:"Numbers",label:"Numbers"},{value:"MusicLoops1",label:"Music Loops 1"},{value:"Mystery",label:"Mystery"},{value:"Notifications",label:"Notifications"},{value:"OdeToJoy",label:"Ode to Joy"},{value:"FurElise",label:"Fur Elise"}];function U(){const[r,$]=c.useState(!1),[v,y]=c.useState(""),[w,k]=c.useState(!0),[m,A]=c.useState(["Numbers","Notifications","Notifications"]),[s,M]=c.useState(null),[p,g]=c.useState(!1),[x,h]=c.useState(!1),S=c.useRef(null),b=(e,i,t)=>{const l=new window.Howl({src:[`${C}/assets/sound/${i}.mp3`],volume:.2,sprite:e.soundSets[i]});e.threads[t]=l};c.useEffect(()=>{if(!r)return;let e;const i=()=>{const n=document.getElementById("video-canvas-video"),o=document.getElementById("video-canvas"),d=document.querySelector(".video-container");if(n&&o&&d){d.contains(n)||d.insertBefore(n,d.firstChild),n.style.display="block",d.contains(o)||d.appendChild(o),o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.pointerEvents="none",o.style.zIndex="10",o.style.display="block";const N=()=>{o.width=640,o.height=480},f=()=>{N()};n.addEventListener("loadedmetadata",f),n.addEventListener("playing",f),N(),e=()=>{n.removeEventListener("loadedmetadata",f),n.removeEventListener("playing",f)}}},t=setInterval(()=>{document.getElementById("video-canvas-video")&&(i(),clearInterval(t))},100),l=setTimeout(()=>clearInterval(t),5e3);return()=>{clearInterval(t),clearTimeout(l),e&&e()}},[r]),c.useEffect(()=>{(async()=>{try{const t=await(await fetch(`${C}/assets/js/howler.js`)).text(),l=document.createElement("script");l.textContent=t,document.head.appendChild(l);const o=await(await fetch(`${C}/assets/js/topcodes.js`)).text(),d=document.createElement("script");d.textContent=o,document.head.appendChild(d);let T=(await(await fetch(`${C}/assets/js/tangible.js`)).text()).replace("export default class Tangible","window.Tangible = class Tangible");T=T.replace(/setupTangible\(\) \{[\s\S]*?setVideoFrameCallback\("video-canvas", function \(jsonString\) \{[\s\S]*?\}, this\);[\s\S]*?\}/,`setupTangible() {
        this.setVideoCanvasHeight('video-canvas');
        let tangible = this;
        
        TopCodes.setVideoFrameCallback("video-canvas", function (jsonString) {
            
            var canvas = document.querySelector("#video-canvas");
            if (!canvas) {
                console.error("Canvas not found in callback!");
                return;
            }
            var ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error("Could not get context in callback!");
                return;
            }
            
            var json = JSON.parse(jsonString);
            var topcodes = json.topcodes;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = "rgba(255, 0, 0, 0.3)";
            ctx.lineWidth = 10;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
            for (let i = 0; i < topcodes.length; i++) {
                ctx.beginPath();
                ctx.arc(topcodes[i].x - (topcodes[i].radius/2), topcodes[i].y, topcodes[i].radius, 0, Math.PI * 2, true);
                ctx.fill();
                ctx.font = "26px Arial";
                ctx.fillStyle = "rgba(255, 0, 0, 0.8)";
                ctx.fillText(topcodes[i].code, topcodes[i].x - topcodes[i].radius, topcodes[i].y);
                ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
            }
            tangible.currentCodes = topcodes;
            tangible.once = true;
        }, this);
    }`);const P=document.createElement("script");if(P.textContent=T,document.head.appendChild(P),await new Promise(u=>setTimeout(u,200)),window.Tangible){const u=new window.Tangible;u.setupTangible(),setTimeout(()=>{const W=document.getElementById("video-canvas");if(W){const E=W.getContext("2d");E?(E.fillStyle="rgba(0, 0, 255, 0.5)",E.fillRect(200,200,100,100)):console.error("Manual test: Could not get canvas context")}else console.error("Manual test: Canvas not found")},1e3),b(u,"Numbers",0),b(u,"Notifications",1),b(u,"Notifications",2),M(u)}else console.error("window.Tangible not available");k(!1)}catch(i){console.error("Error loading scripts:",i),k(!1)}})()},[]);const F=()=>{if(!s){console.error("Tangible instance not initialized");return}const e=!r;s.cameraStatus=e,window.TopCodes&&(window.TopCodes.startStopVideoScan("video-canvas",s.mode),e||setTimeout(()=>{delete window.TopCodes._mediaStreams["video-canvas"]},100)),$(e)},j=(e,i)=>{const t=[...m];t[e]=i,A(t),s&&b(s,i,e)},R=e=>{const i=e.split(`
`).map(n=>n.trim().toLowerCase()),t=[];let l=!1;for(let n=0;n<i.length;n++){const o=i[n];if(o.startsWith("loop"))t.push({type:"loop",index:n+1});else if(o.startsWith("end loop")||o.startsWith("endloop")){if(t.length===0||t[t.length-1].type!=="loop")return{valid:!1,error:`Unexpected end loop at position ${n+1}`};t.pop()}else if(o.startsWith("if"))t.push({type:"if",index:n+1});else if(o.startsWith("end if")||o.startsWith("endif")){if(t.length===0||t[t.length-1].type!=="if")return{valid:!1,error:`Unexpected end if at position ${n+1}`};t.pop()}else if(o.startsWith("function"))t.push({type:"function",index:n+1});else if(o.startsWith("end function")||o.startsWith("endfunction")){if(t.length===0||t[t.length-1].type!=="function")return{valid:!1,error:`Unexpected end function at position ${n+1}`};t.pop()}else if(o.startsWith("x =")||o.startsWith("x="))l=!0;else if((o.startsWith("play x")||o.startsWith("if x"))&&!l)return{valid:!1,error:`Variable used at ${n+1} without being set.`}}if(t.length>0){const n=t[t.length-1];return{valid:!1,error:`Missing end tile for ${n.type} in position ${n.index}.`}}return{valid:!0}},L=()=>{if(!s){console.error("Tangible instance not initialized");return}if(s.isAudioPlaying()){s.stopAllSounds(),h(!1);return}if(r){const i=s.scanCode();if(i){const t=i.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"").toLowerCase().replace(/(^|\n)([a-z])/g,(n,o,d)=>o+d.toUpperCase()).replace(/x/g,"X");y(t);const l=R(t);if(!l.valid&&l.error){s.readCode(l.error);return}if(t&&t.trim()){s.codeThreads=[[],[],[]],s.runTextCode(t),h(!0);const n=setInterval(()=>{s.isAudioPlaying()||(h(!1),clearInterval(n))},100)}return}}const e=S.current?.value||v;if(e&&e.trim()){const i=R(e);if(!i.valid&&i.error){s.readCode(i.error);return}}if(e&&e.trim()){s.codeThreads=[[],[],[]],s.runTextCode(e),h(!0);const i=setInterval(()=>{s.isAudioPlaying()||(h(!1),clearInterval(i))},100)}else s.readCode("No code to run.")},z=()=>{if(!s){console.error("Tangible instance not initialized");return}if(s.synthesis.speaking){s.synthesis.cancel(),g(!1);return}if(s.isAudioPlaying()){s.stopAllSounds();return}if(r){const i=s.scanCode();if(i){const t=i.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"").toLowerCase().replace(/(^|\n)([a-z])/g,(l,n,o)=>n+o.toUpperCase()).replace(/x/g,"X");y(t),t&&t.trim()&&(s.readCode(t),g(!0));return}}const e=S.current?.value||v;e&&e.trim()?(s.readCode(e),g(!0)):s.readCode("No code to read.")};return c.useEffect(()=>{if(!s)return;const e=setInterval(()=>{p&&!s.synthesis.speaking&&g(!1)},100);return()=>clearInterval(e)},[s,p]),c.useEffect(()=>{const e=i=>{i.touches.length===3&&(i.preventDefault(),L())};return document.addEventListener("touchstart",e,{passive:!1}),()=>{document.removeEventListener("touchstart",e)}},[s,r,v]),a.jsxs("div",{className:"app-container",children:[a.jsxs("header",{className:"header",role:"banner",children:[a.jsx("div",{className:"logo-container",children:a.jsx("img",{src:"https://armbennett.github.io/tangible-11ty/assets/img/tibbl-logo.png",alt:"Application logo",className:"logo"})}),a.jsxs("nav",{className:"header-buttons",role:"navigation","aria-label":"Main navigation",children:[a.jsxs("button",{className:"header-button",onClick:F,"aria-label":r?"Disable camera":"Enable camera","aria-pressed":r,disabled:w||!s,children:[a.jsx("i",{className:"fa-solid fa-camera fa-2xl","aria-hidden":"true"}),a.jsx("span",{children:"Camera"})]}),a.jsxs("button",{className:"header-button",onClick:L,"aria-label":x?"Stop code execution":"Play and execute code","aria-pressed":x,disabled:w||!s,children:[a.jsx("i",{className:`fa-solid ${x?"fa-stop":"fa-play"} fa-2xl`,"aria-hidden":"true"}),a.jsx("span",{children:x?"Stop":"Play"})]}),a.jsxs("button",{className:"header-button",onClick:z,"aria-label":p?"Stop reading code":"Read out code text","aria-pressed":p,disabled:w||!s,children:[a.jsx("i",{className:"fa-brands fa-readme fa-2xl","aria-hidden":"true"}),a.jsx("span",{children:p?"Stop":"Read"})]})]})]}),r&&a.jsx("section",{className:"camera-section",role:"region","aria-label":"Camera view",children:a.jsx("div",{className:"video-container",children:a.jsx("canvas",{id:"video-canvas",width:"640",height:"480","aria-label":"Code tile detection overlay"})})}),!r&&a.jsx("canvas",{id:"video-canvas",width:"640",height:"480",style:{display:"none"}}),a.jsxs("section",{className:`output-section ${r?"camera-active":""}`,role:"region","aria-label":"Code output and thread selection",children:[a.jsx("div",{className:"textbox-container",children:a.jsx("textarea",{ref:S,value:v,onChange:e=>y(e.target.value),className:"output-textbox",placeholder:`Thread 1
Loop 4 times
Play 5
End loop
Play 7

Thread 2
Delay 4
Loop 3 times
Play 8
End loop`,"aria-label":"Code output text area"})}),a.jsxs("div",{className:"dropdown-container",children:[a.jsxs("div",{className:"dropdown-group",children:[a.jsx("label",{htmlFor:"thread1",className:"dropdown-label",children:"Thread 1"}),a.jsx("select",{id:"thread1",className:"dropdown",value:m[0],onChange:e=>j(0,e.target.value),"aria-label":"Select Thread 1 sound options",children:I.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("div",{className:"dropdown-group",children:[a.jsx("label",{htmlFor:"thread2",className:"dropdown-label",children:"Thread 2"}),a.jsx("select",{id:"thread2",className:"dropdown",value:m[1],onChange:e=>j(1,e.target.value),"aria-label":"Select Thread 2 sound options",children:I.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("div",{className:"dropdown-group",children:[a.jsx("label",{htmlFor:"thread3",className:"dropdown-label",children:"Thread 3"}),a.jsx("select",{id:"thread3",className:"dropdown",value:m[2],onChange:e=>j(2,e.target.value),"aria-label":"Select Thread 3 sound options",children:I.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]})]})}function H({}){return[{title:"New React Router App"},{name:"description",content:"Welcome to React Router!"}]}const O=B(function(){return a.jsx(U,{})});export{O as default,H as meta};
