import{p as l,a as d,w as R}from"./chunk-EPOLDU6W-CP3WDhNt.js";function W({cameraEnabled:e,isPlaying:i,isReading:t,isLoading:r,tangibleInstance:a,onCameraToggle:o,onPlayStop:s,onRead:n}){return l.jsxs("header",{className:"header",role:"banner",children:[l.jsx("div",{className:"logo-container",children:l.jsx("img",{src:"https://armbennett.github.io/tangible-11ty/assets/img/tibbl-logo.png",alt:"Application logo",className:"logo"})}),l.jsxs("nav",{className:"header-buttons",role:"navigation","aria-label":"Main navigation",children:[l.jsxs("button",{className:"header-button",onClick:o,"aria-label":e?"Disable camera":"Enable camera","aria-pressed":e,disabled:r||!a,children:[l.jsx("i",{className:"fa-solid fa-camera fa-2xl","aria-hidden":"true"}),l.jsx("span",{children:"Camera"})]}),l.jsxs("button",{className:"header-button",onClick:s,"aria-label":i?"Stop code execution":"Play and execute code","aria-pressed":i,disabled:r||!a,children:[l.jsx("i",{className:`fa-solid ${i?"fa-stop":"fa-play"} fa-2xl`,"aria-hidden":"true"}),l.jsx("span",{children:i?"Stop":"Play"})]}),l.jsxs("button",{className:"header-button",onClick:n,"aria-label":t?"Stop reading code":"Read out code text","aria-pressed":t,disabled:r||!a,children:[l.jsx("i",{className:"fa-brands fa-readme fa-2xl","aria-hidden":"true"}),l.jsx("span",{children:t?"Stop":"Read"})]})]})]})}function P({cameraEnabled:e}){return l.jsxs(l.Fragment,{children:[e&&l.jsx("section",{className:"camera-section",role:"region","aria-label":"Camera view",children:l.jsx("div",{className:"video-container",children:l.jsx("canvas",{id:"video-canvas",width:"640",height:"480","aria-label":"Code tile detection overlay"})})}),!e&&l.jsx("canvas",{id:"video-canvas",width:"640",height:"480",style:{display:"none"}})]})}function y({threadNumber:e,value:i,onChange:t,soundSets:r}){const a=`thread${e}`,o=`Thread ${e}`;return l.jsxs("div",{className:"dropdown-group",children:[l.jsx("label",{htmlFor:a,className:"dropdown-label",children:o}),l.jsx("select",{id:a,className:"dropdown",value:i,onChange:s=>t(s.target.value),"aria-label":`Select ${o} sound options`,children:r.map(s=>l.jsx("option",{value:s.value,children:s.label},s.value))})]})}function A({cameraEnabled:e,codeText:i,textareaRef:t,soundSets:r,soundSetOptions:a,onCodeTextChange:o,onSoundSetChange:s}){return l.jsxs("section",{className:`output-section ${e?"camera-active":""}`,role:"region","aria-label":"Code output and thread selection",children:[l.jsx("div",{className:"textbox-container",children:l.jsx("textarea",{ref:t,value:i,onChange:n=>o(n.target.value),className:"output-textbox",placeholder:`Thread 1
Loop 4 times
Play 5
End loop
Play 7

Thread 2
Delay 4
Loop 3 times
Play 8
End loop`,"aria-label":"Code output text area"})}),l.jsxs("div",{className:"dropdown-container",children:[l.jsx(y,{threadNumber:1,value:r[0],onChange:n=>s(0,n),soundSets:a}),l.jsx(y,{threadNumber:2,value:r[1],onChange:n=>s(1,n),soundSets:a}),l.jsx(y,{threadNumber:3,value:r[2],onChange:n=>s(2,n),soundSets:a})]})]})}function L(e){d.useEffect(()=>{if(!e)return;let i;const t=()=>{const o=document.getElementById("video-canvas-video"),s=document.getElementById("video-canvas"),n=document.querySelector(".video-container");if(o&&s&&n){n.contains(o)||n.insertBefore(o,n.firstChild),o.style.display="block",n.contains(s)||n.appendChild(s),s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none",s.style.zIndex="10",s.style.display="block";const c=()=>{s.width=640,s.height=480},u=()=>{c()};o.addEventListener("loadedmetadata",u),o.addEventListener("playing",u),c(),i=()=>{o.removeEventListener("loadedmetadata",u),o.removeEventListener("playing",u)}}},r=setInterval(()=>{document.getElementById("video-canvas-video")&&(t(),clearInterval(r))},100),a=setTimeout(()=>clearInterval(r),5e3);return()=>{clearInterval(r),clearTimeout(a),i&&i()}},[e])}function z(e,i,t){d.useEffect(()=>{if(!e)return;const r=setInterval(()=>{i&&!e.synthesis.speaking&&t(!1)},100);return()=>clearInterval(r)},[e,i,t])}async function M(e,i){const r=await(await fetch(`${e}/assets/js/howler.js`)).text(),a=document.createElement("script");a.textContent=r,document.head.appendChild(a);const s=await(await fetch(`${e}/assets/js/topcodes.js`)).text(),n=document.createElement("script");n.textContent=s,document.head.appendChild(n);let f=(await(await fetch(`${e}/assets/js/tangible.js`)).text()).replace("export default class Tangible","window.Tangible = class Tangible");f=f.replace(/setupTangible\(\) \{[\s\S]*?setVideoFrameCallback\("video-canvas", function \(jsonString\) \{[\s\S]*?\}, this\);[\s\S]*?\}/,`setupTangible() {
        this.setVideoCanvasHeight('video-canvas');
        let tangible = this;
        
        TopCodes.setVideoFrameCallback("video-canvas", function (jsonString) {
            
            var canvas = document.querySelector("#video-canvas");
            if (!canvas) {
                console.error("Canvas not found in callback!");
                return;
            }
            var ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error("Could not get context in callback!");
                return;
            }
            
            var json = JSON.parse(jsonString);
            var topcodes = json.topcodes;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = "rgba(255, 0, 0, 0.3)";
            ctx.lineWidth = 10;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
            for (let i = 0; i < topcodes.length; i++) {
                ctx.beginPath();
                ctx.arc(topcodes[i].x - (topcodes[i].radius/2), topcodes[i].y, topcodes[i].radius, 0, Math.PI * 2, true);
                ctx.fill();
                ctx.font = "26px Arial";
                ctx.fillStyle = "rgba(255, 0, 0, 0.8)";
                ctx.fillText(topcodes[i].code, topcodes[i].x - topcodes[i].radius, topcodes[i].y);
                ctx.fillStyle = "rgba(255, 0, 0, 0.3)";
            }
            tangible.currentCodes = topcodes;
            tangible.once = true;
        }, this);
    }`);const m=document.createElement("script");if(m.textContent=f,document.head.appendChild(m),await new Promise(p=>setTimeout(p,200)),window.Tangible){const p=new window.Tangible;return p.setupTangible(),setTimeout(()=>{const x=document.getElementById("video-canvas");if(x){const v=x.getContext("2d");v?(v.fillStyle="rgba(0, 0, 255, 0.5)",v.fillRect(200,200,100,100)):console.error("Manual test: Could not get canvas context")}else console.error("Manual test: Canvas not found")},1e3),i(p,"Numbers",0),i(p,"Notifications",1),i(p,"Notifications",2),p}else return console.error("window.Tangible not available"),null}function H(e,i,t,r){d.useEffect(()=>{(async()=>{try{const o=await M(e,r);i(o),t(!1)}catch(o){console.error("Error loading scripts:",o),t(!1)}})()},[e,i,t,r])}function F(e,i,t,r){d.useEffect(()=>{const a=o=>{o.touches.length===3&&(o.preventDefault(),i&&t?(async()=>(t.readCode("3"),await new Promise(n=>setTimeout(n,1e3)),t.readCode("2"),await new Promise(n=>setTimeout(n,1e3)),t.readCode("1"),await new Promise(n=>setTimeout(n,1e3)),e()))():e())};return document.addEventListener("touchstart",a,{passive:!1}),()=>{document.removeEventListener("touchstart",a)}},r)}function T(e){return e.replace(/<br\/>/g,`
`).replace(/,\s*X:\[object Object\]/g,"").toLowerCase().replace(/(^|\n)([a-z])/g,(i,t,r)=>t+r.toUpperCase()).replace(/x/g,"X")}function b(e){const i=e.split(`
`).map(a=>a.trim().toLowerCase()),t=[];let r=!1;for(let a=0;a<i.length;a++){const o=i[a];if(o.startsWith("loop"))t.push({type:"loop",index:a+1});else if(o.startsWith("end loop")||o.startsWith("endloop")){if(t.length===0||t[t.length-1].type!=="loop")return{valid:!1,error:`Unexpected end loop at position ${a+1}`};t.pop()}else if(o.startsWith("if"))t.push({type:"if",index:a+1});else if(o.startsWith("end if")||o.startsWith("endif")){if(t.length===0||t[t.length-1].type!=="if")return{valid:!1,error:`Unexpected end if at position ${a+1}`};t.pop()}else if(o.startsWith("function"))t.push({type:"function",index:a+1});else if(o.startsWith("end function")||o.startsWith("endfunction")){if(t.length===0||t[t.length-1].type!=="function")return{valid:!1,error:`Unexpected end function at position ${a+1}`};t.pop()}else if(o.startsWith("x =")||o.startsWith("x="))r=!0;else if((o.startsWith("play x")||o.startsWith("if x"))&&!r)return{valid:!1,error:`Variable used at ${a+1} without being set.`}}if(t.length>0){const a=t[t.length-1];return{valid:!1,error:`Missing end tile for ${a.type} in position ${a.index}.`}}return{valid:!0}}function V(e,i,t,r,a,o){return()=>{if(!e){console.error("Tangible instance not initialized");return}if(e.isAudioPlaying()){e.stopAllSounds(),o(!1);return}if(i){const n=e.scanCode();if(n){const c=T(n);a(c);const u=b(c);if(!u.valid&&u.error){e.readCode(u.error);return}if(c&&c.trim()){e.codeThreads=[[],[],[]],e.runTextCode(c),o(!0);const f=setInterval(()=>{e.isAudioPlaying()||(o(!1),clearInterval(f))},100)}return}}const s=r.current?.value||t;if(s&&s.trim()){const n=b(s);if(!n.valid&&n.error){e.readCode(n.error);return}}if(s&&s.trim()){e.codeThreads=[[],[],[]],e.runTextCode(s),o(!0);const n=setInterval(()=>{e.isAudioPlaying()||(o(!1),clearInterval(n))},100)}else e.readCode("No code to run.")}}function U(e,i,t,r,a,o){return()=>{if(!e){console.error("Tangible instance not initialized");return}if(e.synthesis.speaking){e.synthesis.cancel(),o(!1);return}if(e.isAudioPlaying()){e.stopAllSounds();return}if(i){const n=e.scanCode();if(n){const c=T(n);a(c),c&&c.trim()&&(e.readCode(c),o(!0));return}}const s=r.current?.value||t;s&&s.trim()?(e.readCode(s),o(!0)):e.readCode("No code to read.")}}function j(e,i,t,r){const a=new window.Howl({src:[`${r}/assets/sound/${i}.mp3`],volume:.2,sprite:e.soundSets[i]});e.threads[t]=a}const g="https://raw.githubusercontent.com/armbennett/tangible-11ty/main",D=[{value:"Numbers",label:"Numbers"},{value:"MusicLoops1",label:"Music Loops 1"},{value:"Mystery",label:"Mystery"},{value:"Notifications",label:"Notifications"},{value:"OdeToJoy",label:"Ode to Joy"},{value:"FurElise",label:"Fur Elise"}];function O(){const[e,i]=d.useState(!1),[t,r]=d.useState(""),[a,o]=d.useState(!0),[s,n]=d.useState(["Numbers","Notifications","Notifications"]),[c,u]=d.useState(null),[f,m]=d.useState(!1),[p,x]=d.useState(!1),v=d.useRef(null),N=d.useCallback((h,C,w)=>{j(h,C,w,g)},[]);L(e),z(c,f,m),H(g,u,o,N);const S=V(c,e,t,v,r,x),E=U(c,e,t,v,r,m);F(S,e,c,[c,e,t]);const k=()=>{if(!c){console.error("Tangible instance not initialized");return}const h=!e;c.cameraStatus=h,window.TopCodes&&(window.TopCodes.startStopVideoScan("video-canvas",c.mode),h||setTimeout(()=>{delete window.TopCodes._mediaStreams["video-canvas"]},100)),i(h)},$=(h,C)=>{const w=[...s];w[h]=C,n(w),c&&j(c,C,h,g)};return l.jsxs("div",{className:"app-container",children:[l.jsx(W,{cameraEnabled:e,isPlaying:p,isReading:f,isLoading:a,tangibleInstance:c,onCameraToggle:k,onPlayStop:S,onRead:E}),l.jsx(P,{cameraEnabled:e}),l.jsx(A,{cameraEnabled:e,codeText:t,textareaRef:v,soundSets:s,soundSetOptions:D,onCodeTextChange:r,onSoundSetChange:$})]})}function _({}){return[{title:"New React Router App"},{name:"description",content:"Welcome to React Router!"}]}const J=R(function(){return l.jsx(O,{})});export{J as default,_ as meta};
